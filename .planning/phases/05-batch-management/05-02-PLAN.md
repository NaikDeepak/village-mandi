---
phase: 05-batch-management
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - web/src/pages/admin/BatchesPage.tsx
  - web/src/pages/admin/BatchFormPage.tsx
  - web/src/App.tsx
autonomous: false
---

<objective>
Build the Batch list and form pages for admin batch management.

Purpose: Enable admins to view all batches (with current batch prominently displayed) and create/edit batches.

Output: BatchesPage with timeline-focused view, BatchFormPage for create/edit, routes registered.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
@./.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-batch-management/05-CONTEXT.md

# Existing UI patterns:
@web/src/pages/admin/FarmersPage.tsx
@web/src/pages/admin/FarmerFormPage.tsx
@web/src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: BatchesPage with present-focused view</name>
  <files>web/src/pages/admin/BatchesPage.tsx, web/src/App.tsx</files>
  <action>
Create BatchesPage following FarmersPage pattern but with timeline focus:

**Layout:**
- Hero section: Current OPEN batch (if any) displayed prominently with:
  - Batch name, hub name
  - Cutoff countdown (time remaining or "Cutoff passed")
  - Delivery date
  - Quick action: "View Details" link to batch detail page
  - Status badge (OPEN, with green styling)
- If no OPEN batch: Show "No active batch" message with "Create Batch" CTA

**Below hero: Batch list table:**
- Columns: Name, Hub, Status, Cutoff, Delivery Date, Actions
- Status badges with colors:
  - DRAFT: gray
  - OPEN: green
  - CLOSED: yellow
  - COLLECTED: blue
  - DELIVERED: purple
  - SETTLED: dark gray
- Actions: View, Edit (only for DRAFT)
- Filter tabs: All, Active (DRAFT/OPEN/CLOSED), Completed (COLLECTED/DELIVERED/SETTLED)
- Sort by: createdAt desc (newest first)

**API calls:**
- GET /batches/current for hero section
- GET /batches for list

**Register route in App.tsx:** /admin/batches → BatchesPage

Use existing Tailwind patterns from FarmersPage. Follow mandi color palette (mandi-green for OPEN status).
  </action>
  <verify>npm run build succeeds, page renders at /admin/batches</verify>
  <done>BatchesPage shows current batch hero, batch list with status filters, proper routing</done>
</task>

<task type="auto">
  <name>Task 2: BatchFormPage for create/edit</name>
  <files>web/src/pages/admin/BatchFormPage.tsx, web/src/App.tsx</files>
  <action>
Create BatchFormPage following FarmerFormPage pattern:

**Form fields:**
- Hub: Select dropdown (fetched from GET /hubs)
- Name: Text input (required, min 2 chars)
- Cutoff Date/Time: datetime-local input (must be future)
- Delivery Date: date input (must be after cutoff)

**Validation (client-side with React Hook Form + Zod):**
- Name: required, min 2 characters
- Hub: required, must select from list
- Cutoff: required, must be in the future
- Delivery: required, must be after cutoff

**Behavior:**
- Create mode (/admin/batches/new): POST to /batches
- Edit mode (/admin/batches/:id/edit):
  - GET /batches/:id to populate
  - PUT to /batches/:id
  - Only allow editing DRAFT batches (show warning if not DRAFT)
- On success: redirect to /admin/batches

**Register routes in App.tsx:**
- /admin/batches/new → BatchFormPage
- /admin/batches/:id/edit → BatchFormPage

**Important:** For edit mode, if batch is not DRAFT, show read-only view with message: "Only DRAFT batches can be edited"
  </action>
  <verify>npm run build succeeds, form validates, create/edit work</verify>
  <done>BatchFormPage creates new batches, edits DRAFT batches, validates cutoff/delivery dates</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Batch list page with hero section and form page for create/edit</what-built>
  <how-to-verify>
    1. Run: cd server && npm run dev (in one terminal)
    2. Run: cd web && npm run dev (in another terminal)
    3. Visit: http://localhost:5173/admin/batches (login as admin first)
    4. Verify hero section shows "No active batch" (or current batch if one exists)
    5. Click "Add Batch" and verify form appears
    6. Create a batch:
       - Select a hub (may need to create one via API first)
       - Enter name "Test Batch"
       - Set cutoff to tomorrow
       - Set delivery to day after tomorrow
       - Submit
    7. Verify redirect to /admin/batches and new batch appears in list
    8. Verify DRAFT badge shows correctly
    9. Click "Edit" on the batch, verify form populates
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd web && npm run build` succeeds
- [ ] BatchesPage displays current batch hero
- [ ] Batch list shows with status badges
- [ ] BatchFormPage creates new batches
- [ ] BatchFormPage edits DRAFT batches
- [ ] Human verification approved
</verification>

<success_criteria>
- All tasks completed
- Human verified the UI works correctly
- No TypeScript/build errors
- Routes properly registered
</success_criteria>

<output>
After completion, create `.planning/phases/05-batch-management/05-02-SUMMARY.md`
</output>
