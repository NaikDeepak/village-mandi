# Plan 09-01: Aggregation API & Procurement UI

Implement the logic to aggregate confirmed orders into procurement lists for administrators.

## User Stories
- **Admin**: "I want to see the total quantity of each product I need to procure for a closed batch so I can plan my pickup."
- **Admin**: "I want to see a list of items I need to buy from each farmer so I can send them a WhatsApp message."

## Technical Tasks

1. **Backend API**:
   - Create `GET /batches/:id/aggregation` in `server/src/routes/batches.ts` (or a new aggregation route).
   - Logic:
     - Find all orders for `batchId` where status is `COMMITMENT_PAID` or `FULLY_PAID`.
     - Sum `orderedQty` for each `batchProductId`.
     - Include product names, units, and farmer details.
     - Group results by Farmer for procurement planning.

2. **Integration Tests**:
   - Add tests for the aggregation logic in a new test file or existing batch tests.
   - Verify that `PLACED` orders are excluded.
   - Verify correct summing of quantities.

3. **Frontend UI**:
   - Create `web/src/pages/admin/BatchProcurementPage.tsx`.
   - Display a summary of total products needed.
   - Display detailed lists grouped by Farmer.
   - Add "Copy for WhatsApp" button for each farmer's list.

4. **Routing**:
   - Update `web/src/App.tsx` to include the procurement route.
   - Add a "Procurement" button/link in `BatchDetailPage.tsx`.

## Success Criteria
- [ ] Admin can view total quantities needed for a batch.
- [ ] List is correctly filtered to only include confirmed (paid) orders.
- [ ] Quantities are grouped by farmer for easy communication.
- [ ] WhatsApp-ready text can be copied for each farmer.
