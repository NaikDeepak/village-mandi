---
phase: 21-app-check-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [web/package.json, web/src/lib/firebase.ts, web/src/lib/api.ts]
autonomous: true
must_haves:
  truths:
    - "Frontend requests include App Check token header"
    - "App Check initialized with ReCAPTCHA Enterprise"
  artifacts:
    - path: "web/src/lib/firebase.ts"
      provides: "App Check initialization"
  key_links:
    - from: "web/src/lib/api.ts"
      to: "X-Firebase-AppCheck header"
      via: "getToken()"
---

<objective>
Implement Firebase App Check on the frontend.

Purpose: Close the security gap where backend expects App Check tokens but frontend never sends them.
Output: Wired frontend that authenticates its legitimacy to the backend.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/v1.1-MILESTONE-AUDIT.md
@web/package.json
</context>

<tasks>

<task type="auto">
  <name>Install App Check Dependency</name>
  <files>web/package.json</files>
  <action>
    Since we are using the modular `firebase` SDK (v11+), App Check is included, but we might need to ensure imports are correct.
    Verify `firebase` package version.
    No extra install usually needed for modular SDK, but double check.
  </action>
  <verify>grep "firebase" web/package.json</verify>
  <done>Dependency ready</done>
</task>

<task type="auto">
  <name>Initialize App Check</name>
  <files>web/src/lib/firebase.ts</files>
  <action>
    Import `initializeAppCheck`, `ReCaptchaEnterpriseProvider` (or V3) from `firebase/app-check`.
    Initialize it:
    ```typescript
    const appCheck = initializeAppCheck(app, {
      provider: new ReCaptchaEnterpriseProvider('YOUR_SITE_KEY'),
      isTokenAutoRefreshEnabled: true
    });
    ```
    Note: We need a Site Key. For now, use a placeholder or check env vars. If missing, use `self.FIREBASE_APPCHECK_DEBUG_TOKEN = true` for localhost dev.
  </action>
  <verify>App Check initialized in code</verify>
  <done>App Check active</done>
</task>

<task type="auto">
  <name>Attach Token to API Requests</name>
  <files>web/src/lib/api.ts</files>
  <action>
    Modify the API client (axios/fetch wrapper) to:
    1. Get App Check token: `getToken(appCheck)`
    2. Add header `X-Firebase-AppCheck: token.token` to all requests (or at least auth/protected ones).
  </action>
  <verify>API client includes header logic</verify>
  <done>Tokens sent to backend</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` in web succeeds
</verification>

<success_criteria>
- Frontend wired to send App Check tokens
- Code compiles
</success_criteria>

<output>
After completion, create `.planning/phases/21-app-check-integration/21-01-SUMMARY.md`
</output>
