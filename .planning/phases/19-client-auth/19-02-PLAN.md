---
phase: 19-client-auth
plan: 02
type: execute
wave: 2
depends_on: ["19-01"]
files_modified: [web/src/components/auth/PhoneLoginForm.tsx, web/src/pages/VerifyOtpPage.tsx, web/src/lib/api.ts]
autonomous: true
must_haves:
  truths:
    - "Invisible reCAPTCHA initializes correctly"
    - "User can enter phone and OTP"
    - "Backend verification endpoint is called"
  artifacts:
    - path: "web/src/components/auth/PhoneLoginForm.tsx"
      provides: "Phone login UI"
  key_links:
    - from: "PhoneLoginForm"
      to: "usePhoneAuth"
      via: "hook"
    - from: "PhoneLoginForm"
      to: "/api/auth/firebase-verify"
      via: "api.verifyFirebaseToken"
---

<objective>
Integrate Phone Auth UI and connect to backend verification.

Purpose: Replace mock login forms with real Firebase Phone Auth components.
Output: Working login form with reCAPTCHA and OTP entry.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-client-auth/19-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Create PhoneLoginForm Component</name>
  <files>web/src/components/auth/PhoneLoginForm.tsx</files>
  <action>
    Create component with:
    - Phone input (with country code +91 default)
    - "Send OTP" button (disabled during cooldown)
    - Invisible reCAPTCHA container (`<div id="recaptcha-container"></div>`)
    - OTP input field (shown after SMS sent)
    - "Verify" button
    - Integration with `usePhoneAuth` hook
  </action>
  <verify>Component compiles</verify>
  <done>UI for phone auth exists</done>
</task>

<task type="auto">
  <name>Add Backend Verification Method</name>
  <files>web/src/lib/api.ts</files>
  <action>
    Add `verifyFirebaseToken(idToken: string)` to the API client.
    - POST to `/auth/firebase-verify`
    - Handle response (token, user)
    - Update auth store (Zustand) on success
  </action>
  <verify>Method exists in api.ts</verify>
  <done>API client updated</done>
</task>

<task type="auto">
  <name>Update VerifyOtpPage</name>
  <files>web/src/pages/VerifyOtpPage.tsx</files>
  <action>
    Replace existing mock OTP page with `PhoneLoginForm`.
    - Handle successful login navigation (redirect to /shop or /dashboard)
    - Display errors from hook
  </action>
  <verify>Page uses new component</verify>
  <done>Mock flow replaced</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` in web succeeds
</verification>

<success_criteria>
- Login UI updated
- Backend token exchange connected
- Mock code removed
</success_criteria>

<output>
After completion, create `.planning/phases/19-client-auth/19-02-SUMMARY.md`
</output>
