---
phase: 18-backend-auth
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [server/package.json, server/src/plugins/rate-limit.ts, server/src/index.ts]
autonomous: true
must_haves:
  truths:
    - "Auth endpoints are rate-limited"
    - "Global security headers are applied"
  artifacts:
    - path: "server/src/plugins/rate-limit.ts"
      provides: "Rate limiting configuration"
  key_links: []
---

<objective>
Implement security controls for the backend API.

Purpose: Protect against SMS pumping, brute force attacks, and common web vulnerabilities.
Output: Rate limiting and security headers configured.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@server/package.json
</context>

<tasks>

<task type="auto">
  <name>Install Security Dependencies</name>
  <files>server/package.json</files>
  <action>
    Install `@fastify/rate-limit` and `@fastify/helmet` in the server workspace.
    Run `npm install @fastify/rate-limit @fastify/helmet --workspace=server`.
  </action>
  <verify>grep "@fastify/rate-limit" server/package.json</verify>
  <done>Dependencies installed</done>
</task>

<task type="auto">
  <name>Configure Rate Limiting</name>
  <files>server/src/plugins/rate-limit.ts, server/src/index.ts</files>
  <action>
    Create rate limit plugin configuration.
    - Global limit: ~100 requests/minute (reasonable for API).
    - Auth limit: Strict limit for `/auth/*` routes (e.g., 5 requests/minute per IP) to prevent SMS pumping and brute force.
    Register plugin in `server/src/index.ts`.
  </action>
  <verify>Plugin registered in index.ts</verify>
  <done>Rate limits active</done>
</task>

<task type="auto">
  <name>Configure Security Headers</name>
  <files>server/src/index.ts</files>
  <action>
    Register `@fastify/helmet` in `server/src/index.ts`.
    Use sensible defaults, ensuring CORS compatibility.
  </action>
  <verify>Helmet registered</verify>
  <done>Security headers applied</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` in server succeeds
- [ ] Server starts without errors
</verification>

<success_criteria>
- Rate limiting protects auth endpoints
- Security headers enabled
</success_criteria>

<output>
After completion, create `.planning/phases/18-backend-auth/18-02-SUMMARY.md`
</output>
